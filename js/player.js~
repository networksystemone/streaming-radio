var playerCompatible = true var play = false; var tracks ;var itemcurrent ;$.ajax({    async: false,    url: "mp3_json.php",    type: 'GET',    data:{'page':page, 'id': id ,'query':query},    dataType: 'json',    success: function(json) {    	if(json==0) tracks="";    	else tracks=json;    	    }});var currentTrack = 0;var timer = null; 		$('document').ready(function(){								$('#compatibility').css('display','none');			$('header').css('display','block');			$('#contentContainer').css('display','block');			var item = tracks[0];			itemcurrent=item;			idd=item['track'];			$('#imgsong').attr('src',item['img']);			$('#audioPlayer').attr('src',item['file']);			$('#song').html(item['name'].substr(0, 40)+"...");			$('#songMobile').html(item['track'] + ' - ' + item['name']);			$('#audioPlayer')[0].load();						if(Modernizr.localstorage){			var savedVol = localStorage.getItem('volume');			if(savedVol != null){				$('#volume').val(savedVol);				$('#audioPlayer')[0].volume = savedVol / 100;			}		}					$('#btnReverse').click(function(){				   currentTrack=itemcurrent['track']-1 ;					if(currentTrack > 0){						$('#playItem'+currentTrack).attr('class','glyphicon glyphicon-play');						currentTrack--;						$('#playItem'+currentTrack).attr('class','glyphicon glyphicon-pause');						$('#audioPlayer')[0].pause();						changeSong(currentTrack);					}							});							$('#btnPlayPause').click(function(){				var idd=itemcurrent['track']-1 ;				if(play){										play = false;					$('#audioPlayer')[0].pause();					$('#playItem').attr('class','glyphicon glyphicon-play');					$('#playItem'+idd).attr('class','glyphicon glyphicon-play');					clearInterval(timer);				}else{					play = true;					$('#audioPlayer')[0].play();					$('#playItem').attr('class','glyphicon glyphicon-pause');					$('#playItem'+idd).attr('class','glyphicon glyphicon-pause');					displayDurationAndTotalTime();					timer = setInterval("intervalRefresh()",1000);									}			});			$('#btnForward').click(function(){				 	currentTrack=itemcurrent['track']-1 ;					if(currentTrack < tracks.length - 1){						$('#playItem'+currentTrack).attr('class','glyphicon glyphicon-play');						currentTrack++;						$('#playItem'+currentTrack).attr('class','glyphicon glyphicon-pause');						$('#audioPlayer')[0].pause();						changeSong(currentTrack);					}							});						$('#audioPlay').on('canPlay', function(){				alert('toto');			});						$('#volume').change(function(ev){				ev.preventDefault();				var vol = document.getElementById('volume').value;				$('#audioPlayer')[0].volume = vol / 100;				if(Modernizr.localstorage){	localStorage.setItem('volume', vol); }			});			$('#volumeoff').click(function(){				var vol=0;				$('#audioPlayer')[0].volume = vol / 100;				if(Modernizr.localstorage){	localStorage.setItem('volume', vol); 				$('#volume').val('0');}			});			$('#volumemax').click(function(){				var vol=100;				$('#audioPlayer')[0].volume = vol / 100;				if(Modernizr.localstorage){	localStorage.setItem('volume', vol); 				$('#volume').val('100');}			});	});	function changeSong(id){	 var item = tracks[id];	 itemcurrent=item;	$('#imgsong').attr('src',item['img']);	$('#audioPlayer').attr('src',item['file']);	$('#song').html(item['name'].substr(0, 40)+"...");	$('#songMobile').html(item['track'] + ' - ' + item['name']);	$('#artist').html(item['artist']);	$('#artistMobile').html(item['artist']);	$('#audioPlayer')[0].load();	if(play) $('#audioPlayer')[0].play();}			function intervalRefresh(){	displayDurationAndTotalTime();	ajustProgression();}function displayDurationAndTotalTime(){	$('#currentTime').html(convertSecToMinutes($('#audioPlayer')[0].currentTime));	$('#totalTime').html(convertSecToMinutes($('#audioPlayer')[0].duration));}function ajustProgression(){	var player = $('#audioPlayer')[0];	var current = player.currentTime;	var total = player.duration;	var time = 0	var progress = (current * 100) / total;		$('#avancement').val(Math.round(progress));	$('#avancement').change(function(ev){				ev.preventDefault();				var pl = document.getElementById('avancement').value;				$('#audioPlayer')[0].currentTime = (pl * total) /100 ;				if(Modernizr.localstorage){	localStorage.setItem('avancement', pl); }			});       if(current==total){		$('#avancement').val(Math.round(0));	$('#currentTime').html("0:00");	play = false;	var idd=itemcurrent['track']-1 ;	$('#playItem').attr('class','glyphicon glyphicon-play');	$('#playItem'+idd).attr('class','glyphicon glyphicon-play');	}}function convertSecToMinutes(time){var ret = null;if(time != 0){	var secondes = time % 60;	var entier = (time - secondes) / 60;	ret = entier.toString();			if(secondes < 10){		ret += ":" + "0" + Math.round(secondes).toString();	}else{		ret += ":" + Math.round(secondes).toString();	}	}else{	ret = "0:00";}if(ret == "NaN:NaN"){	ret = "0:00";}	return ret}function PlayPause(id){				id-- ;				var idd=itemcurrent['track']-1 ;				if(play){						if(id==idd){						play = false;						$('#audioPlayer')[0].pause();						$('#playItem'+idd).attr('class','glyphicon glyphicon-play');						$('#playItem').attr('class','glyphicon glyphicon-play');						    clearInterval(timer);					}else{					 play = true;					 changeSong((id));					 $('#playItem'+idd).attr('class','glyphicon glyphicon-play');					 $('#playItem').attr('class','glyphicon glyphicon-pause');					 $('#playItem'+id).attr('class','glyphicon glyphicon-pause');					}					}else{						if(id==idd){						play = true;						$('#audioPlayer')[0].play();						$('#playItem').attr('class','glyphicon glyphicon-pause');						$('#playItem'+id).attr('class','glyphicon glyphicon-pause');						displayDurationAndTotalTime();						timer = setInterval("intervalRefresh()",1000);						}else{						play = true;						changeSong((id));						$('#playItem').attr('class','glyphicon glyphicon-pause');						$('#playItem'+id).attr('class','glyphicon glyphicon-pause');						displayDurationAndTotalTime();						timer = setInterval("intervalRefresh()",1000);}				}}							